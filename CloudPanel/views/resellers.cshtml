@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<dynamic>

@{
    Layout = "_master.cshtml";
}

@section PAGEHEADER{
    <div class="pageheader">
        <h2><i class="fa fa-university"></i> @Text.words.Resellers <span>@Text.phrases.Resellers_Title</span></h2>
    </div>
}

<div class="row">
    <a href="#" class="btn btn-success mr5 pull-right" data-toggle="modal" data-target=".new-reseller-modal">@Text.words.Add</a>
</div>

<div class="mb30"></div>

<!-- Table -->
<div class="row">
    <div class="panel panel-default">
        <div class="panel-body">
            <table id="resellerDataTable" class="table table-dark table-hover mb30">
                <thead>
                    <tr>
                        <th>@Text.words.Name</th>
                        <th>@Text.words.Address</th>
                        <th>@Text.words.Created</th>
                        <th>@Text.words.Companies</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Loading data...</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- New or Update Reseller -->
<form id="resellerForm" method="post" action="" data-parsley-validate>
    <input type="hidden" name="_method" value="" />
    <div class="modal fade new-reseller-modal" id="modifyModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" data-backdrop="static" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>
                    <h4 class="modal-title">Reseller</h4>
                </div>
                <div class="modal-body">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Name <span class="asterisk">*</span></label>
                            <input type="text" name="CompanyName" class="form-control" data-parsley-required>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Contact's Name</label>
                            <input type="text" name="AdminName" class="form-control" data-parsley-required>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Contact's Email</label>
                            <input type="text" name="AdminEmail" class="form-control" data-parsley-type="email" data-parsley-required>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Telephone</label>
                            <input type="text" name="PhoneNumber" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Street</label>
                            <input type="text" name="Street" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label">City</label>
                            <input type="text" name="City" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label">State</label>
                            <input type="text" name="State" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label">Postal Code</label>
                            <input type="text" name="ZipCode" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Country</label>
                            @CloudPanel.CustomHtmlHelpers.GetCountries("")
                        </div>
                    </div>
                    <div style="text-align: right" class="clearfix">
                        <br />
                        <input id="btnSave" type="submit" value="Save" class="btn btn-success" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Delete Reseller -->
<form id="deleteResellerForm" method="post" action="~/Resellers">
    <input type="hidden" name="_method" value="DELETE" />
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">Delete Reseller</h4>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this reseller?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input id="btnDelete" type="submit" value="Delete" class="btn btn-danger" />
                </div>
            </div>
        </div>
    </div>
</form>


@section CUSTOMJAVASCRIPT{
<script src="~/content/js/jquery.validate.min.js"></script>
<script src="~/Content/js/jquery.datatables.min.js"></script>
<script src="~/content/js/moment-with-locales.js"></script>
<script type="text/javascript">
    $(document).ready(function () {

        $("#resellerDataTable").dataTable({
            "processing": true,
            "serverSide": true,
            "ajax": "@Url.Content("~/resellers/json/dt")",
            "pagingType": "full_numbers",
            "columns": [
                {
                    "data": "companyCode", "render": function (data, type, full, meta) {
                        return '<a href="../companies/' + data + '">' + full["companyName"] + '</a>';
                    }
                },
                { "data": "fullAddressFormatted" },
                {
                    "data": "created", "render": function (data, type, full, meta) {
                        var formattedDate = moment(data).format('MMMM Do YYYY, h:mm:ss a');
                        return formattedDate.toString();
                    }
                },
                { "data": "totalCompanies" },
                {
                    "data": "companyCode", "render": function (data, type, full, meta) {
                        return GenerateButton(data);
                    }
                },
            ]
        });

        $(document).on("click", "#deleteResellerLink", function () {
            $("#deleteResellerForm").attr("action", "@Url.Content("~/Resellers/")" + $(this).data("id"));
        });

        $(document).on("click", "#updateResellerLink", function () {
            $("#updateResellerForm").attr("")
        });
    });

    function GenerateButton(companyCode)
    {
        return "<div class='btn-group mr5 pull-right'> \
                <button type='button' class='btn btn-xs btn-warning dropdown-toggle' data-toggle='dropdown'> \
                  Modify <span class='caret'></span> \
                </button> \
                <ul class='dropdown-menu' role='menu'> \
                  <li><a href='javascript:;' data-toggle='editModal' data-id='"+companyCode+"'>Edit</a></li> \
                  <li class='divider'></li> \
                  <li><a href='javascript:void(0);' id='deleteResellerLink' data-toggle='modal' data-target='#deleteModal' data-id='"+companyCode+"'>Delete</a></li> \
                </ul> \
              </div>";
    }

    function GetReseller(resellerCode)
    {
        $.ajax({
            url: "@Url.Content("~/Resellers/")" + resellerCode,
            dataType: "JSON",
            type: "GET",
            cache: false,
            success: function (data) {
                $.each(data, function (k, v) {
                    var field = $("#updateResellerForm #" + k);

                    if (field.length) {
                        if (field.is("input:text") || field.is(":hidden")) {
                            field.val(v);
                        } else if (field.is("select")) {
                            field.val(v);
                            field.trigger("chosen:updated");
                        }
                    }
                });

                $("#updateModal").modal();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }
        });
    }
</script>
}