@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<dynamic>

@{
    Layout = "__master.cshtml";
}
@section HEAD{
    <link href="~/Content/plugins/datatables-1.10.2/media/css/jquery.dataTables.bootstrap.css" rel="stylesheet" />
}

<div id="page-heading">
    <ol class="breadcrumb">
        <li class="active">Dashboard</li>
    </ol>
</div>

<div class="container">
    <!-- Top -->
    <div id="badgeRow" class="row">
        <div class="col-md-2">
            <a href="#" class="shortcut-tiles tiles-info">
                <div class="tiles-body">
                    <div class="pull-left"><i class="fa fa-user"></i></div>
                    <div class="pull-right"><span id="badgeUsers" class="badge"></span></div>
                </div>
                <div class="tiles-footer">
                    Users
                </div>
            </a>
        </div> <!-- Users -->
        <div class="col-md-2">
            <a href="#" class="shortcut-tiles tiles-orange">
                <div class="tiles-body">
                    <div class="pull-left"><i class="fa fa-gears"></i></div>
                    <div class="pull-right"><span id="badgeAdmins" class="badge"></span></div>
                </div>
                <div class="tiles-footer">
                    Company Admins
                </div>
            </a>
        </div> <!-- Company Admins -->
        <div class="col-md-2">
            <a href="#" class="shortcut-tiles tiles-success">
                <div class="tiles-body">
                    <div class="pull-left"><i class="fa fa-globe"></i></div>
                    <div class="pull-right"><span id="badgeDomains" class="badge"></span></div>
                </div>
                <div class="tiles-footer">
                    Domains
                </div>
            </a>
        </div> <!-- Domains -->
        <div class="col-md-2">
            <a href="#" class="shortcut-tiles tiles-magenta">
                <div class="tiles-body">
                    <div class="pull-left"><i class="fa fa-envelope"></i></div>
                    <div class="pull-right"><span id="badgeMailboxes" class="badge"></span></div>
                </div>
                <div class="tiles-footer">
                    Mailboxes
                </div>
            </a>
        </div> <!-- Mailboxes -->
        <div class="col-md-2">
            <a href="#" class="shortcut-tiles tiles-midnightblue">
                <div class="tiles-body">
                    <div class="pull-left"><i class="fa fa-upload"></i></div>
                    <div class="pull-right"><span id="badgeMailboxAllocated" class="badge"></span></div>
                </div>
                <div class="tiles-footer">
                    Mailbox Space Allocated
                </div>
            </a>
        </div> <!-- Mailbox Space Allocated -->
        <div class="col-md-2">
            <a href="#" class="shortcut-tiles tiles-green">
                <div class="tiles-body">
                    <div class="pull-left"><i class="fa fa-download"></i></div>
                    <div class="pull-right"><span id="badgeMailboxUsed" class="badge"></span></div>
                </div>
                <div class="tiles-footer">
                    Mailbox Space Used
                </div>
            </a>
        </div> <!-- Mailbox Space Used -->
    </div>

    <!-- Graphs -->
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-info">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12 clearfix">
                            <h4 class="pull-left" style="margin: 0 0 20px;">System History</h4>
                            <div class="btn-group pull-right">
                                <a href="javascript:GetHistoryOverview(6);" class="btn btn-default btn-sm">6 Months</a>
                                <a href="javascript:GetHistoryOverview(12);" class="btn btn-default btn-sm">12 Months</a>
                                <a href="javascript:GetHistoryOverview(24);" class="btn btn-default btn-sm">24 Months</a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div id="historyOverview" style="height:250px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-grape">
                <div class="panel-heading">
                    <h4>Top Customers by Users</h4>
                    <div class="options">
                        <div class="btn-group">
                            <button class="btn btn-default btn-xs" onclick="javascript: GetTopCustomers(5);"> Top 5 </button>
                            <button class="btn btn-default btn-xs" onclick="javascript: GetTopCustomers(10);"> Top 10 </button>
                            <button class="btn btn-default btn-xs" onclick="javascript: GetTopCustomers(15);"> Top 15 </button>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="list-group topXCustomers">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
    </div>
</div>

@section JAVASCRIPT{
    <script src="~/Content/plugins/charts-flot/jquery.flot.min.js"></script>
    <script src="~/Content/plugins/charts-flot/jquery.flot.orderBars.min.js"></script>
    <script src="~/Content/plugins/charts-flot/jquery.flot.pie.min.js"></script>
    <script src="~/Content/plugins/charts-highcharts/js/highcharts.js"></script>
    <script src="~/Content/plugins/datatables-1.10.2/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/plugins/datatables-1.10.2/media/js/dataTables.bootstrap.js"></script>
    <script src="~/Content/plugins/moment/moment-with-locales.js"></script>
    <script type="text/javascript">
    var exchangeModule = @CloudPanel.Base.Config.Settings.ExchangeModule.ToString().ToLower()

        $(document).ready(function () {

            // Get top row tiles data
            GetTiles();

            // Gets the history overview area chart
            GetHistoryOverview(6);
        });

        function GetTiles() {
            $("#badgeRow").block();
            $.getJSON("", function (stats) {
                $("#badgeUsers").text(stats.totalUsers);
                $("#badgeAdmins").text(stats.totalAdmins);
                $("#badgeDomains").text(stats.totalDomains);
                $("#badgeMailboxes").text(stats.totalMailboxes);
                $("#badgeMailboxAllocated").text(stats.totalMailboxAllocated);
                $("#badgeMailboxUsed").text(stats.totalMailboxUsed);
            })
            .fail(function (data) {
                ShowError(data.responseJSON.error);
            })
            .always(function (data) {
                $("#badgeRow").unblock();
            });
        }

        function GetHistoryOverview(pastMonths) {
            $("#historyOverview").block();
            $.getJSON("@Url.Content("~/dashboard/history/months/")" + pastMonths, function (data) {
                    var areaChart = new Highcharts.Chart({
                        chart: {
                            renderTo: 'historyOverview',
                            backgroundColor: 'transparent'
                        },
                        title: { text: '' },
                        credits: { enabled: false },
                        xAxis: { categories: data.months },
                        yAxis: { min: 0, title: { text: '' } },
                        plotOptions: {
                            series: { connectNulls: true },
                            area: { fillOpacity: 0.2 }
                        },
                        tooltip: {
                            pointFormat: '{series.name} <b>{point.y:,.0f}</b>',
                        },
                    });

                    areaChart.addSeries({ name: "Users", data: data.users });

                    if (data.exchange.length)
                        areaChart.addSeries({ name: "Mailboxes", data: data.exchange });

                    if (data.citrix.length)
                        areaChart.addSeries({ name: "Citrix", data: data.citrix });

                    areaChart.redraw();
                })
                .fail(function (data) {
                    ShowError(data.responseJSON.error);
                })
                .always(function (data) {
                    $("#historyOverview").unblock();
                });
        }

        function showTooltip(x, y, contents) {
            $('<div id="tooltip" class="tooltip top in"><div class="tooltip-inner">' + contents + '<\/div><\/div>').css({
                display: 'none',
                top: y - 40,
                left: x - 55,
            }).appendTo("body").fadeIn(200);
        }
    </script>
}